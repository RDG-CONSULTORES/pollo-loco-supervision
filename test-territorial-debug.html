<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Territorial Filter</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
        }
        .result {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è Debug Territorial Filter</h1>
    
    <div class="debug-panel">
        <h3>Test Classification Functions</h3>
        <button class="test-button" onclick="testGroupClassification()">Test Group Classification</button>
        <button class="test-button" onclick="testTerritorialMapping()">Test Territorial Mapping</button>
        <button class="test-button" onclick="testAPIData()">Test API Data</button>
        <div id="results" class="result"></div>
    </div>

    <script>
        const results = document.getElementById('results');
        
        // Mapping territorial de grupos mixtos (copiar del dashboard)
        const territorialMapping = {
            'GRUPO SALTILLO': {
                local: ['01 - Saltillo Centro', '02 - Saltillo Sur', '03 - Saltillo Norte', '04 - Ramos Arizpe', '05 - Arteaga'],
                foranea: ['57 - Harold R. Pape']
            },
            'GRUPO TEC': {
                local: ['14 - Tec de Monterrey', '15 - San Nicol√°s Tec', '16 - Apodaca Tec'],
                foranea: ['58 - Guasave']
            },
            'GRUPO EXPO': {
                local: ['20 - Expo', '21 - Expo Norte', '22 - Expo Sur', '23 - San Pedro Expo', 
                       '24 - Guadalupe Expo', '25 - Escobedo Expo', '26 - Garc√≠a Expo',
                       '27 - Santiago Expo', '29 - Ju√°rez Expo'],
                foranea: ['30 - Carrizo', '28 - Guerrero']
            }
        };

        // Funciones de clasificaci√≥n (copiar del dashboard)
        function isLocalGroup(groupName) {
            if (territorialMapping[groupName]) {
                return territorialMapping[groupName].local.length > 0;
            }
            
            const localGroups = ['OGAS', 'TEPEYAC', 'EFM', 'GRUPO NUEVO LE√ìN'];
            const foraneasGroups = ['PLOG QUERETARO', 'PLOG TAMAULIPAS'];
            
            if (localGroups.some(local => groupName.includes(local))) {
                return true;
            }
            
            if (foraneasGroups.some(foranea => groupName.includes(foranea))) {
                return false;
            }
            
            return !groupName.toLowerCase().includes('quer√©taro') && 
                   !groupName.toLowerCase().includes('tamaulipas') &&
                   !groupName.toLowerCase().includes('laredo');
        }

        function isForaneaGroup(groupName) {
            if (territorialMapping[groupName]) {
                return territorialMapping[groupName].foranea.length > 0;
            }
            
            const foraneasGroups = ['PLOG QUERETARO', 'PLOG TAMAULIPAS'];
            
            if (foraneasGroups.some(foranea => groupName.includes(foranea))) {
                return true;
            }
            
            return groupName.toLowerCase().includes('quer√©taro') || 
                   groupName.toLowerCase().includes('tamaulipas') ||
                   groupName.toLowerCase().includes('laredo');
        }

        function testGroupClassification() {
            results.innerHTML = 'üß™ Testing Group Classification...\n\n';
            
            // Test groups from actual API
            const testGroups = [
                'OGAS', 'PLOG QUERETARO', 'EPL SO', 'TEC', 'TEPEYAC',
                'PLOG LAGUNA', 'EXPO', 'GRUPO MATAMOROS', 'GRUPO PIEDRAS NEGRAS',
                'GRUPO RIO BRAVO', 'EFM', 'PLOG NUEVO LEON', 'RAP', 'OCHTER TAMPICO',
                'GRUPO CANTERA ROSA (MORELIA)', 'GRUPO SABINAS HIDALGO',
                'CRR', 'GRUPO CENTRITO', 'GRUPO NUEVO LAREDO (RUELAS)', 'GRUPO SALTILLO'
            ];
            
            testGroups.forEach(group => {
                const isLocal = isLocalGroup(group);
                const isForanea = isForaneaGroup(group);
                const isMixed = isLocal && isForanea;
                
                let classification = '';
                if (isMixed) classification = 'üîÄ MIXED';
                else if (isLocal) classification = 'üè† LOCAL';
                else if (isForanea) classification = 'üåê FORANEA';
                else classification = '‚ùì UNKNOWN';
                
                results.innerHTML += `${classification} | ${group}\n`;
            });
        }

        function testTerritorialMapping() {
            results.innerHTML = 'üó∫Ô∏è Testing Territorial Mapping...\n\n';
            
            Object.keys(territorialMapping).forEach(group => {
                const mapping = territorialMapping[group];
                results.innerHTML += `${group}:\n`;
                results.innerHTML += `  üè† Local: ${mapping.local.length} sucursales\n`;
                results.innerHTML += `  üåê For√°nea: ${mapping.foranea.length} sucursales\n`;
                results.innerHTML += `  üìç isLocal: ${isLocalGroup(group)}\n`;
                results.innerHTML += `  üåç isForanea: ${isForaneaGroup(group)}\n\n`;
            });
        }

        async function testAPIData() {
            results.innerHTML = 'üì° Testing API Data...\n\n';
            
            try {
                const response = await fetch('http://localhost:3000/api/heatmap-periods');
                const data = await response.json();
                
                if (data.success && data.data) {
                    const { groups, periods } = data.data;
                    
                    results.innerHTML += `üìä API returned ${groups.length} groups, ${periods.length} periods\n\n`;
                    
                    // Test filtering
                    const localGroups = groups.filter(g => isLocalGroup(g.grupo));
                    const foraneasGroups = groups.filter(g => isForaneaGroup(g.grupo));
                    
                    results.innerHTML += `üè† Local groups: ${localGroups.length}\n`;
                    localGroups.forEach(g => {
                        results.innerHTML += `  - ${g.grupo}\n`;
                    });
                    
                    results.innerHTML += `\nüåê For√°nea groups: ${foraneasGroups.length}\n`;
                    foraneasGroups.forEach(g => {
                        results.innerHTML += `  - ${g.grupo}\n`;
                    });
                    
                } else {
                    results.innerHTML += '‚ùå API Error: ' + JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                results.innerHTML += '‚ùå Fetch Error: ' + error.message;
            }
        }
        
        // Auto-run tests on load
        console.log('üß™ Debug page loaded');
        testGroupClassification();
    </script>
</body>
</html>